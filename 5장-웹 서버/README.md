## 5장 웹 서버

### 5.1 다채로운 웹 서버

웹서버: 웹 서버 소프트웨어와 웹페이지 제공에 특화된 장비 양쪽 모두

리소스에 대한 HTTP 요청을 받아서 콘텐츠를 클라이언트에게 돌려준다.

- 웹서버 구현
  - HTTP 프로토콜을 구현하고, 웹 리소스를 관리하고, 웹 서버 관리 기능을 제공
  - 1. 다목적 소프트웨어 웹 서버
    - 네트워크에 연결된 표준 컴퓨터 시스템에서 동작
  - 2. 임베디드 웹 서버
    - 일반 소비자용 제품에 내장될 목적으로 만들어진 작은 웹 서버

### 5.3 진짜 웹 서버가 하는 일 (공통적으로)

1. 커넥션을 맺는다.
2. 요청을 받는다.
3. 요청을 처리한다.
4. 리소스에 접근한다.
5. 응답을 만든다.
6. 응답을 보낸다.
7. 트랜잭션을 로그로 남긴다.

### 5.4 (1) 클라이언트 커넥션 수락

- 새 커넥션 다루기
  - 서버에 대해 지속적 커넥션을 가지고 있는 경우 → 그대로 사용
  - 없는 경우 → 새로운 커넥션을 연다.
  - 클라이언트 → TCP 커넥션 요청
  - 웹서버 → 커넥션을 맺고, 클라이언트 확인, 커넥션이 받아들여지면 새 커넥션을 커넥션 목록에 추가
- 클라이언트 호스트 명 식별
  - 역방향 DNS
- ident를 통해 클라이언트 사용자 알아두기
  - ident 프로토콜: 서버에게 어떤 사용자 이름이 HTTP 커넥션을 초기화했는지 찾아낼 수 있게 해줌
    - 웹 서버 로깅에 유용
    - 안전하지 않고 조작하기 쉬움 → 잘 사용하지 않음.

### 5.5 (2) 요청 메시지 수신

- 요청 메시지를 파싱한다.
- 네트워크 커넥션은 언제든 무효화될 수 있기 때문에 웹서버는 메시지 일부분을 메모리에 임시로 저장해둘 필요가 있음.
- 파싱 후 내부의 자료 구조에 저장
- 커넥션 입력/출력 처리 아키텍처
  - 단일 스레드 웹 서버
  - 멀티프로세스와 멀티스레드 웹 서버: 많은 리소스 소비. 최대 개수에 제한
  - 다중 I/O 아키텍처: 모든 코넥션 감시 → 커넥션 상태가 바뀌면 다음번 상태 변경을 위해 열린 커넥션 목록으로 돌아감
  - 다중 멀티스레드 웹 서버: 멀티 스레딩과 다중화의 결합

### 5.6 (3) 요청 처리

요청으로부터 메서드, 리소스, 헤더, 본문을 얻어 처리함.

### 5.7 (4) 리소스의 매핑과 접근

- Docroot (문서 루트)
  - 요청 메시지에서 uri를 가져와 문서 루트 뒤에 붙임.
  - 요청 uri → 웹 서버의 파일 시스템 안에 있는 파일 이름으로 사용
  - 가상 호스팅으로 한 웹 서버에서 여러 개의 웹 사이트를 호스팅할 수 있음
- 접근 제어할 수 있음

### 5.8 (5) 응답 만들기

응답 상태코드, 응답 헤더, 응답 본문을 포함

- 응답 본문의 MIME 타입을 서술하는 content-type 헤더
  - mime.types (목록 나열)
  - 매직 타이핑
  - 유형 명시
  - 유형 협상
- 응답 본문의 길이를 서술하는 content-length 헤더
- 실제 응답 본문의 내용

### 5.9 (6) 응답 보내기

서버는 커넥션 상태를 추적해야 함.

### 5.10 (7) 로깅

트랜잭션이 완료되었을 때 어떻게 수행되었는지에 대한 로그를 로그파일에 기록 (21장에 설명)
